import{_ as s,o as a,c as n,R as l}from"./chunks/framework.M8QmVFdX.js";const o="/vitepress/assets/image1.Bhv5sWQF.png",e="/vitepress/assets/image2.1EhAxJhQ.png",p="/vitepress/assets/image3.8rFG2gWj.png",t="/vitepress/assets/image4.X_-2IdiL.png",c="/vitepress/assets/image5.jY97VLBo.png",r="/vitepress/assets/image6.OBm3WcI3.png",i="/vitepress/assets/image7._25-SqRD.png",k=JSON.parse('{"title":"jenkins与gitlab自动化部署","description":"","frontmatter":{},"headers":[],"relativePath":"blog/jenkins/jenkins-and-gitlab.md","filePath":"blog/jenkins/jenkins-and-gitlab.md","lastUpdated":1717050767000}'),d={name:"blog/jenkins/jenkins-and-gitlab.md"},y=l('<h1 id="jenkins与gitlab自动化部署" tabindex="-1">jenkins与gitlab自动化部署 <a class="header-anchor" href="#jenkins与gitlab自动化部署" aria-label="Permalink to &quot;jenkins与gitlab自动化部署&quot;">​</a></h1><h2 id="需求目的" tabindex="-1">需求目的 <a class="header-anchor" href="#需求目的" aria-label="Permalink to &quot;需求目的&quot;">​</a></h2><ul><li>项目发测试环境时，每次都需要手动打包，然后把打包文件通过<code>xftp</code>放入对应文件夹下，很麻烦，而且由于手动，是容易出错的！！！</li><li>为此，需要通过自动化工具，使得当<code>test</code>分支的代码上传时，自动触发打包，之后自动帮我们放到对应的目录文件夹下，这样就实现自动化打包了！</li></ul><h2 id="操作流程" tabindex="-1">操作流程 <a class="header-anchor" href="#操作流程" aria-label="Permalink to &quot;操作流程&quot;">​</a></h2><h3 id="_1-jenkins新建任务" tabindex="-1">1.Jenkins新建任务 <a class="header-anchor" href="#_1-jenkins新建任务" aria-label="Permalink to &quot;1.Jenkins新建任务&quot;">​</a></h3><p><img src="'+o+'" alt="图片"></p><ul><li>点进去之后是这样一个页面</li></ul><p><img src="'+e+'" alt="图片"></p><ul><li>填一个任务名，选择<code>自由风格的</code>，之后点击确定就行了</li></ul><h3 id="_2-jenkins进行相关配置" tabindex="-1">2.Jenkins进行相关配置 <a class="header-anchor" href="#_2-jenkins进行相关配置" aria-label="Permalink to &quot;2.Jenkins进行相关配置&quot;">​</a></h3><p><img src="'+p+'" alt="图片"></p><ul><li>这里的<code>Repository URL</code>需要注意不是git的那个地址，需要在前面加上用户信息</li></ul><p><img src="'+t+'" alt="图片"></p><ul><li><p>分支信息需要填写哪个分支提交触发这个任务</p></li><li><p><code>触发器</code>这里有这样一段话<code>GitLab webhook URL: http://192.168.7.41:9999/jenkins/project/FE-adtp-admin-html-test</code>，这个意思是需要你在gitlab项目里面进行配置，这个暂时放着，等下再弄！！！</p></li><li><p>只勾选<code>Push Events</code>代表push的时候触发</p></li></ul><p><img src="'+c+`" alt="图片"></p><ul><li>这里构建里面<code>增加构建步骤</code>里面有个<code>执行shell</code>选择这个</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/jenkins/jenkins_data/workspace/FE-adtp-admin-html-test</span></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node_modules</span></span>
<span class="line"><span style="color:#B392F0;">nrm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">taobao</span></span>
<span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--unsafe-perm=true</span></span>
<span class="line"><span style="color:#E1E4E8;">NODE_OPTIONS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">--max_old_space_size=</span><span style="color:#79B8FF;">4096</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build-test</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zcvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist.tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./</span><span style="color:#79B8FF;">*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/jenkins/jenkins_data/workspace/FE-adtp-admin-html-test</span></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node_modules</span></span>
<span class="line"><span style="color:#6F42C1;">nrm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">taobao</span></span>
<span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--unsafe-perm=true</span></span>
<span class="line"><span style="color:#24292E;">NODE_OPTIONS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">--max_old_space_size=</span><span style="color:#005CC5;">4096</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build-test</span></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zcvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist.tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./</span><span style="color:#005CC5;">*</span></span></code></pre></div><ul><li>shell命令，自行体会，<code>tar zcvf dist.tar ./*</code>这句话的意思是打成<code>tar</code>的压缩包</li></ul><p><img src="`+r+`" alt="图片"></p><ul><li><code>增加构建后操作步骤</code>里面选择<code>Send build artifacts over SSH</code></li><li><code>Name</code>里面选择打包文件需要放的服务器</li><li><code>Source files</code>是源文件的目录</li><li><code>Remove prefix</code>是源文件删除的目录</li><li><code>Remote directory</code>是需要放到的目标文件路径</li><li><code>Exec command</code> 这个是额外的脚本内容（重点）</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/jenkins/upload/FE-adtp-admin-html-test/dist</span></span>
<span class="line"><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist.tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/html/sub</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/html/sub</span></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adtp-admin/</span><span style="color:#79B8FF;">*</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zxvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist.tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adtp-admin/</span></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist.tar</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/jenkins/upload/FE-adtp-admin-html-test/dist</span></span>
<span class="line"><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist.tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/html/sub</span></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/html/sub</span></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adtp-admin/</span><span style="color:#005CC5;">*</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zxvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist.tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adtp-admin/</span></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist.tar</span></span></code></pre></div><ul><li>自行理解，<code>tar zxvf dist.tar -C adtp-admin/</code>这段话是解压缩文件</li></ul><h3 id="_3-gitlab进行相关配置" tabindex="-1">3.gitlab进行相关配置 <a class="header-anchor" href="#_3-gitlab进行相关配置" aria-label="Permalink to &quot;3.gitlab进行相关配置&quot;">​</a></h3><p>到上面两步，基本上就可以了，但是尝试后发现可以手动构建，但是<code>push</code>代码后不会自动触发，原因是<code>gitlab</code>里面需要在<code>设置</code>里设置<code>webhooks</code></p><p><img src="`+i+'" alt="图片"></p><ul><li>这里的网址填写前面<code>GitLab webhook URL: http://192.168.7.41:9999/jenkins/project/FE-adtp-admin-html-test</code>这段话中的网址就行，即<code>http://192.168.7.41:9999/jenkins/project/FE-adtp-admin-html-test</code>这个，<code>推送事件</code>填写分支<code>test</code>，然后保存就可以了</li></ul><h2 id="大功告成" tabindex="-1">大功告成 <a class="header-anchor" href="#大功告成" aria-label="Permalink to &quot;大功告成&quot;">​</a></h2><ul><li>这样就可以愉快的写代码然后push到测试环境，会自动打包了，妈妈再也不用担心文件夹路径放错啦！nice~</li></ul>',28),E=[y];function F(m,h,u,C,_,g){return a(),n("div",null,E)}const B=s(d,[["render",F]]);export{k as __pageData,B as default};
