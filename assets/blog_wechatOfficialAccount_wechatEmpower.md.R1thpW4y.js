import{_ as e,o as a,c as o,R as t}from"./chunks/framework.M8QmVFdX.js";const f=JSON.parse('{"title":"微信公众号h5授权","description":"","frontmatter":{},"headers":[],"relativePath":"blog/wechatOfficialAccount/wechatEmpower.md","filePath":"blog/wechatOfficialAccount/wechatEmpower.md","lastUpdated":1701259688000}'),c={name:"blog/wechatOfficialAccount/wechatEmpower.md"},d=t('<h1 id="微信公众号h5授权" tabindex="-1">微信公众号h5授权 <a class="header-anchor" href="#微信公众号h5授权" aria-label="Permalink to &quot;微信公众号h5授权&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>同事离职了，于是我接手了他的h5项目，需求是在目前嵌套在我们公众号的h5页面中，用户订单支付后，公众号推一个消息提醒，其实这是一个很常见的需求。</p><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h2><p>目前官方文档是有这个能力的,无非就是会有亿点细节而已</p><h3 id="_1-相关文档" tabindex="-1">1.相关文档 <a class="header-anchor" href="#_1-相关文档" aria-label="Permalink to &quot;1.相关文档&quot;">​</a></h3><ul><li><a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html" target="_blank" rel="noreferrer">模板消息接口</a></li><li><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noreferrer">网页授权</a></li></ul><p>其中模板消息接口是可以发送模板消息，但是需要用户的<code>openId</code>，这个<code>openId</code>是用户关注公众号生成的一个唯一凭证，所以我们需要先进行网页授权来获取用户的<code>openId</code></p><p>模板发送接口我们后端已经二次封装好了，所以目前的难点就是获取用户的<code>openId</code></p><h3 id="_2-网页授权" tabindex="-1">2.网页授权 <a class="header-anchor" href="#_2-网页授权" aria-label="Permalink to &quot;2.网页授权&quot;">​</a></h3><p>微信授权目前有两种授权方式<code>scope=snsapi_base</code>(静默授权，用户无感知，不会出现授权弹窗)和<code>scope=snsapi_userinfo</code>(弹出授权页面，用户有感知，会出现授权弹窗)，由于我这边只需要<code>openId</code>，不需要用户的其他信息，所以我选择了<code>scope=snsapi_base</code></p><p>授权流程如下:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">用户同意授权，获取code -&gt; 通过code调用接口拿到用户`openId`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">用户同意授权，获取code -&gt; 通过code调用接口拿到用户`openId`</span></span></code></pre></div><h4 id="_2-1-用户同意授权-获取code" tabindex="-1">2.1 用户同意授权，获取code <a class="header-anchor" href="#_2-1-用户同意授权-获取code" aria-label="Permalink to &quot;2.1 用户同意授权，获取code&quot;">​</a></h4><h4 id="_2-2-通过code调用接口拿到用户openid" tabindex="-1">2.2 通过code调用接口拿到用户<code>openId</code> <a class="header-anchor" href="#_2-2-通过code调用接口拿到用户openid" aria-label="Permalink to &quot;2.2 通过code调用接口拿到用户`openId`&quot;">​</a></h4>',15),n=[d];function r(s,i,l,p,h,_){return a(),o("div",null,n)}const b=e(c,[["render",r]]);export{f as __pageData,b as default};
